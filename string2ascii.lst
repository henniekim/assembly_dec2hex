


ARM Macro Assembler    Page 1 


    1 00000000                 area             num2ascii_code ,code
    2 00000000                 export           num2ascii
    3 00000000                 entry
    4 00000000         ;----------------------------------------------
    5 00000000         num2ascii
                               proc
    6 00000000 B57F            stmfd            sp!, {r0-r6, lr}
    7 00000002 9D08            ldr              r5, [sp, #32]
    8 00000004 4E29            ldr              r6, =asc_table ; load asc_table
                                                             address
    9 00000006         ;---------------------------------------------    
   10 00000006 2D00            cmp              r5, #0x0    ; if the number is 
                                                            0
   11 00000008 D024            beq              all_zero
   12 0000000A 2D10            cmp              r5, #0x10   ;if the number is b
                                                            etween 1~f then bra
                                                            nch to
   13 0000000C DB2D            blt              four_zero
   14 0000000E F5B5 7F80       cmp              r5, #0x100  ; 10~ff
   15 00000012 DB33            blt              three_zero
   16 00000014 F5B5 5F80       cmp              r5, #0x1000 ;100~fff
   17 00000018 DB37            blt              two_zero
   18 0000001A F5B5 3F80       cmp              r5, #0x10000 ; 1000~ffff
   19 0000001E DB39            blt              one_zero
   20 00000020         ;---------------------------------------------
   21 00000020 F405 2070       and              r0, r5, #0x000F0000 ; get hex 4
                                                            
   22 00000024 EA4F 4020       asr              r0, #16     ;      shift right 
                                                            to handle easy
   23 00000028 5C30            ldrb             r0, [r6,r0] ;    load r0 from [
                                                            table address + off
                                                            set]
   24 0000002A         ;  
   25 0000002A F405 4170 
                       first_zero
                               and              r1, r5, #0x0000F000 ; get hex 3
                                                            
   26 0000002E EA4F 3121       asr              r1, #12     ;      shit right t
                                                            o handle easy
   27 00000032 5C71            ldrb             r1, [r6,r1]
   28 00000034         ;
   29 00000034 F405 6270 
                       second_zero
                               and              r2, r5, #0x00000F00 ; get hex 2
                                                            
   30 00000038 EA4F 2222       asr              r2, #8
   31 0000003C 5CB2            ldrb             r2, [r6,r2]
   32 0000003E         ;    
   33 0000003E F005 03F0 
                       third_zero
                               and              r3, r5, #0x000000F0 ; get hex 1
                                                            
   34 00000042 EA4F 1323       asr              r3, #4
   35 00000046 5CF3            ldrb             r3, [r6,r3]
   36 00000048         ;  
   37 00000048 F005 040F 
                       fourth_zero
                               and              r4, r5, #0x0000000F ; get hex 0
                                                            



ARM Macro Assembler    Page 2 


   38 0000004C 5D34            ldrb             r4, [r6,r4]
   39 0000004E         ;
   40 0000004E B41F    everything_zero
                               stmfd            sp!, {r0-r4}
   41 00000050 B005            add              sp, #20
   42 00000052 BD7F            ldmfd            sp!,{r0-r6, pc} ; subroutine en
                                                            ds here 
   43 00000054         ;----to make the first '0' strings to '0' not '0x30'----
                       -----
   44 00000054 F04F 0000 
                       all_zero
                               mov              r0, #0
   45 00000058 F04F 0100       mov              r1, #0
   46 0000005C F04F 0200       mov              r2, #0
   47 00000060 F04F 0300       mov              r3, #0
   48 00000064 F04F 0400       mov              r4, #0
   49 00000068 E7F1            b                everything_zero
   50 0000006A F04F 0000 
                       four_zero
                               mov              r0, #0
   51 0000006E F04F 0100       mov              r1, #0
   52 00000072 F04F 0200       mov              r2, #0
   53 00000076 F04F 0300       mov              r3, #0
   54 0000007A E7E5            b                fourth_zero
   55 0000007C F04F 0000 
                       three_zero
                               mov              r0, #0
   56 00000080 F04F 0100       mov              r1, #0
   57 00000084 F04F 0200       mov              r2, #0
   58 00000088 E7D9            b                third_zero
   59 0000008A F04F 0000 
                       two_zero
                               mov              r0, #0
   60 0000008E F04F 0100       mov              r1, #0
   61 00000092 E7CF            b                second_zero
   62 00000094 F04F 0000 
                       one_zero
                               mov              r0, #0
   63 00000098 E7C7            b                first_zero
   64 0000009A         ;------------------------------------------------
   65 0000009A         asc_table                            ; table for string 
                                                            to ascii
   66 0000009A 30              dcb              0x30        ;0
   67 0000009B 31              dcb              0x31        ;1
   68 0000009C 32              dcb              0x32        ;2
   69 0000009D 33              dcb              0x33        ;3
   70 0000009E 34              dcb              0x34        ;4
   71 0000009F 35              dcb              0x35        ;5
   72 000000A0 36              dcb              0x36        ;6
   73 000000A1 37              dcb              0x37        ;7
   74 000000A2 38              dcb              0x38        ;8
   75 000000A3 39              dcb              0x39        ;9
   76 000000A4 41              dcb              0x41        ;A
   77 000000A5 42              dcb              0x42        ;B
   78 000000A6 43              dcb              0x43        ;C
   79 000000A7 44              dcb              0x44        ;D
   80 000000A8 45              dcb              0x45        ;E
   81 000000A9 46              dcb              0x46        ;F
   82 000000AA         ;------------------------------------------------



ARM Macro Assembler    Page 3 


   83 000000AA                 endp
   84 000000AA 00 00 00000000  area             asciidata, data
   85 00000000                 end
Command Line: --debug --xref --cpu=Cortex-M3 --apcs=interwork --depend=.\string
2ascii.d -o.\string2ascii.o -ID:\keil\ARM\RV31\INC -ID:\keil\ARM\CMSIS\Include 
-ID:\keil\ARM\Inc\ST\STM32F10x --predefine="__EVAL SETA 1" --list=.\string2asci
i.lst string2ascii.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

all_zero 00000054

Symbol: all_zero
   Definitions
      At line 44 in file string2ascii.s
   Uses
      At line 11 in file string2ascii.s
Comment: all_zero used once
asc_table 0000009A

Symbol: asc_table
   Definitions
      At line 65 in file string2ascii.s
   Uses
      At line 8 in file string2ascii.s
Comment: asc_table used once
everything_zero 0000004E

Symbol: everything_zero
   Definitions
      At line 40 in file string2ascii.s
   Uses
      At line 49 in file string2ascii.s
Comment: everything_zero used once
first_zero 0000002A

Symbol: first_zero
   Definitions
      At line 25 in file string2ascii.s
   Uses
      At line 63 in file string2ascii.s
Comment: first_zero used once
four_zero 0000006A

Symbol: four_zero
   Definitions
      At line 50 in file string2ascii.s
   Uses
      At line 13 in file string2ascii.s
Comment: four_zero used once
fourth_zero 00000048

Symbol: fourth_zero
   Definitions
      At line 37 in file string2ascii.s
   Uses
      At line 54 in file string2ascii.s
Comment: fourth_zero used once
num2ascii 00000000

Symbol: num2ascii
   Definitions
      At line 5 in file string2ascii.s
   Uses
      At line 2 in file string2ascii.s
Comment: num2ascii used once
num2ascii_code 00000000

Symbol: num2ascii_code



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

   Definitions
      At line 1 in file string2ascii.s
   Uses
      None
Comment: num2ascii_code unused
one_zero 00000094

Symbol: one_zero
   Definitions
      At line 62 in file string2ascii.s
   Uses
      At line 19 in file string2ascii.s
Comment: one_zero used once
second_zero 00000034

Symbol: second_zero
   Definitions
      At line 29 in file string2ascii.s
   Uses
      At line 61 in file string2ascii.s
Comment: second_zero used once
third_zero 0000003E

Symbol: third_zero
   Definitions
      At line 33 in file string2ascii.s
   Uses
      At line 58 in file string2ascii.s
Comment: third_zero used once
three_zero 0000007C

Symbol: three_zero
   Definitions
      At line 55 in file string2ascii.s
   Uses
      At line 15 in file string2ascii.s
Comment: three_zero used once
two_zero 0000008A

Symbol: two_zero
   Definitions
      At line 59 in file string2ascii.s
   Uses
      At line 17 in file string2ascii.s
Comment: two_zero used once
13 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

asciidata 00000000

Symbol: asciidata
   Definitions
      At line 84 in file string2ascii.s
   Uses
      None
Comment: asciidata unused
1 symbol
347 symbols in table
